<html>
  <head>
    <!--<link href='http://fonts.googleapis.com/css?family=Gloria+Hallelujah|Coming+Soon|Delius|Rock+Salt|Architects+Daughter|Permanent+Marker|Indie+Flower|Schoolbell|Neucha' rel='stylesheet' type='text/css'>-->
    <!--
	some google fonts for use
	font-family: 'Gloria Hallelujah', cursive;
	font-family: 'Coming Soon', cursive;
	font-family: 'Delius', cursive;
	font-family: 'Rock Salt', cursive;
	font-family: 'Architects Daughter', cursive;
	font-family: 'Permanent Marker', cursive;
	font-family: 'Indie Flower', cursive;
	font-family: 'Schoolbell', cursive;
	font-family: 'Neucha', cursive;
      -->
    <title>{{ name }} | xwords</title>
    <link href="http://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="/site_media/js/jquery-1.3.2.js"></script>
    <script type="text/javascript" src="/site_media/js/jquery.hotkeys-0.7.8.js"></script>
    <script type="text/javascript" src="/site_media/js/cufon-yui.js"></script>
    <script type="text/javascript" src="/site_media/js/ballpoint_400.font.lh.js"></script>
    <link rel="stylesheet" href="/site_media/css/master.css" />
    <noscript>
      <link rel="stylesheet" href="/site_media/css/mobile.min.css" />
    </noscript>
    <script>
      // Edit to suit your needs.
      var ADAPT_CONFIG = {
      // Where is your CSS?
      path: '/site_media/css/',

      // false = Only run once, when page first loads.
      // true = Change on window resize and page tilt.
      dynamic: true,

      // First range entry is the minimum.
      // Last range entry is the maximum.
      // Separate ranges by "to" keyword.
      range: [
      '0px    to 760px  = mobile.min.css',
      '760px  to 980px  = 720.min.css',
      '980px  to 1280px = 960.min.css',
      '1280px to 1600px = 1200.min.css',
      '1600px to 1940px = 1560.min.css',
      '1940px to 2540px = 1920.min.css',
      '2540px           = 2520.min.css'
      ]
      };
    </script>
    <script src="/site_media/js/adapt.min.js"></script>
    <script type="text/javascript">
      Cufon.replace('.letter');
    </script>
    <script type="text/javascript" charset="utf-8">
      function trim(s){ 
        return ( s || '' ).replace( /^\s+|\s+$/g, '' ); 
      }
      $(document).ready(function(){
      // defaults
      var align = "across";
      var in_focus = "0";
      var f = function(e) {
			  $('#notes-form').show();
			  $('#clue-id').attr('value', e.attr('id'));
                          $('#clue-notes').val(trim(e.next().text()));
			};

     $('#write-note').click(function() {
       $.ajax({
         type: "POST",
         dataType: "json",
         url: "/add-note/",
         data: { "clue": $('#clue-id').val(), "note": $('#clue-notes').val(), "crossword" : {{ crossword_id }},  csrfmiddlewaretoken: '{{ csrf_token }}' },
         error: handleFail,
         success : done2
       });
     });

     $('#add-favorite').click(function() {
       $.ajax({
         type: "POST",
         dataType: "json",
         url: "/add-favorite/",
         data: { "clue": $('#clue-id').val(), "crossword" : {{ crossword_id }},  csrfmiddlewaretoken: '{{ csrf_token }}' },
         error: handleFail,
         success : done
       });
     });
      
    $('#clue-notes').focus(function() {in_focus = "x";});
    var handleFail = function(xhr, msg) {alert(msg);}
    var done2 = function(data) { $('#'+data.clue).next().text(data.note); }
    var done = function(data) { $('#'+data.clue).addClass('favorite'); }

      $(".across_clues > .clue").click(function(e) {
      align = "across";
      $("#box_"+in_focus).css("background-color", "white");
      in_focus = this.id.slice(0, this.id.length-1);
      $("#box_"+in_focus).css("background-color", "#99cc00");
      f($(this));
      if($(this).hasClass('favorite')) {
        $('#add-favorite').hide();
      }
      else {
        $('#add-favorite').show();
      }
      });

      $(".down_clues > .clue").click(function(e) {
      align = "down";
      $("#box_"+in_focus).css("background-color", "white");
      in_focus = this.id.slice(0, this.id.length-1);
      $("#box_"+in_focus).css("background-color", "#99cc00");
      f($(this));
      if($(this).hasClass('favorite')) {
        $('#add-favorite').hide();
      }
      else {
        $('#add-favorite').show();
      }
      });

      function find_next_square() {
      if(align == "across") {
      var next_square = parseInt(in_focus) + 1;
      }
      else {
      var next_square = parseInt(in_focus) + 15;
      }
      return next_square;
      }

      function find_prev_square() {
      if(align == "across") {
      var prev_square = parseInt(in_focus) - 1;
      }
      else {
      var prev_square = parseInt(in_focus) - 15;
      }
      return prev_square;
      }

      function is_across(current_box) {
      if((current_box % 15 == 0) || (current_box % 15 == 1)) {
      current_box= parseInt(current_box)+15;
      return ($("#box_"+current_box).attr("class").indexOf("black-box") != -1);
      }
      var next_square = parseInt(current_box) + 1;
      var prev_square = parseInt(current_box) - 1;
      if(next_square > 255) {
      return true;
      }
      return ( ($("#box_"+next_square).attr("class").indexOf("black-box") == -1) || 
      ($("#box_"+prev_square).attr("class").indexOf("black-box") == -1) );
      }

      $(".tile").click(function(e) {
      var current_box = this.id.split("_")[1];
      if(is_across(current_box)) {
      align = "across";
      }
      else {
      align = "down";
      }
      $("#box_"+in_focus).css("background-color", "white");
      in_focus = this.id.split("_")[1];
      $("#box_"+in_focus).css("background-color", "#99cc00");
      });

      var bkspc = function(s){
      $("#box_"+in_focus).css("background-color", "white");
      in_focus = find_prev_square(); 
      $("#box_"+in_focus + "> .letter").text("");
      $("#box_"+in_focus + "> input").val("");
      $("#box_"+in_focus).css("background-color", "#99cc00");
      }

      $(document).bind('keydown', 'backspace', bkspc);


      var key_map = function(s){
      $("#box_"+in_focus + "> .letter").text(String.fromCharCode(s.keyCode));
      $("#box_"+in_focus + "> input").val(String.fromCharCode(s.keyCode));
      $("#box_"+in_focus).css("background-color", "white");
      var next_square = find_next_square();
      if(next_square > 225) { Cufon.replace('.letter'); return false; }
      if($("#box_"+next_square).attr("class").indexOf("black-box") != -1) { Cufon.replace('.letter'); return false; }
      in_focus = next_square;
      $("#box_"+in_focus).css("background-color", "#99cc00");
      Cufon.replace('.letter');
      }

      var alphabets = 'abcdefghijklmnopqrstuvwxyz';
      for(var i=0; i <= alphabets.length; i++) {
			$(document).bind('keydown', alphabets[i], key_map);
			}

			});

			</script> 
    <style type="text/css">
      table.grid {
        border-spacing: 1px;
        border-collapse: separate;
      }
      table.grid td {
        padding: 2px;
      }
      @font-face {
      font-family:"ballpoint";
      src:url("/site_media/fonts/fg-ballpoint.ttf");
      }
      .notes { display: none; }
      .grid {
      margin-bottom: 20px;
      }

#add-favorite,
#write-note {
  margin-top: 20px;
}


#add-favorite,
#write-note,
#save_crossword {
  background-color: #a5b8da;
  background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #a5b8da), color-stop(100%, #7089b3));
  background-image: -webkit-linear-gradient(top, #a5b8da, #7089b3);
  background-image: -moz-linear-gradient(top, #a5b8da, #7089b3);
  background-image: -ms-linear-gradient(top, #a5b8da, #7089b3);
  background-image: -o-linear-gradient(top, #a5b8da, #7089b3);
  background-image: linear-gradient(top, #a5b8da, #7089b3);
  border-top: 1px solid #758fba;
  border-right: 1px solid #6c84ab;
  border-bottom: 1px solid #5c6f91;
  border-left: 1px solid #6c84ab;
  border-radius: 18px;
  -webkit-box-shadow: inset 0 1px 0 0 #aec3e5;
  box-shadow: inset 0 1px 0 0 #aec3e5;
  color: #fff;
  font: bold 11px/1 "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", Geneva, Verdana, sans-serif;
  padding: 8px 0;
  text-align: center;
  text-shadow: 0 -1px 1px #64799e;
  text-transform: uppercase;
  width: 150px; 
  }

  #add-favorite:hover,
  #write-note:hover,
  #save_crossword:hover {
    background-color: #9badcc;
    background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #9badcc), color-stop(100%, #687fa6));
    background-image: -webkit-linear-gradient(top, #9badcc, #687fa6);
    background-image: -moz-linear-gradient(top, #9badcc, #687fa6);
    background-image: -ms-linear-gradient(top, #9badcc, #687fa6);
    background-image: -o-linear-gradient(top, #9badcc, #687fa6);
    background-image: linear-gradient(top, #9badcc, #687fa6);
    border-top: 1px solid #6d86ad;
    border-right: 1px solid #647a9e;
    border-bottom: 1px solid #546685;
    border-left: 1px solid #647a9e;
    -webkit-box-shadow: inset 0 1px 0 0 #a5b9d9;
    box-shadow: inset 0 1px 0 0 #a5b9d9;
    cursor: pointer; 
    }

    #add-favorite:active,
    #write-note:active,
    #save_crossword:active {
    border: 1px solid #546685;
    -webkit-box-shadow: inset 0 0 8px 2px #7e8da6, 0 1px 0 0 #eeeeee;
    box-shadow: inset 0 0 8px 2px #7e8da6, 0 1px 0 0 #eeeeee;
    }

      .black-box {
      color:#111111;
      background-color:#111111;
      margin:-3px;
      width:31px; 
      height:31px; 
      font-family:ballpoint, serif; 
      font-weight:bold; 
      font-size:20px; 
      text-align:center;
      border-width:1px;
      }

      .black-box1 {
      background-image:url('/site_media/img/sq1.png');
      }

      .black-box2 {
      background-image:url('/site_media/img/sq2.png');
      }

      .black-box3 {
      background-image:url('/site_media/img/sq3.png');
      }

      .tile {
      color:blue;
      margin:-3px;
      width:30px; 
      height:30px; 
      font-family:ballpoint, serif; 
      font-weight:bold; 
      font-size:20px; 
      text-align:center;
      border-width:1px;
      border: 1px solid;
      border-color: black;
      }

      .across_clues {
      border-right: 1px dashed gray;
      padding-right: 20px;
      }

      .down_clues {
      }

      .clue {
      padding-left:2px;
      pading-right: 2px;
      margin-bottom: 10px;
      color: black;
      cursor: pointer;
      font-family: 'Ubuntu', sans-serif;
      font-size: 15px;
      }

      .clue:hover {
        color: #680000;
        background: #eee;
      }

      .letter {
      margin-top:-10px;
      font-family:ballpoint, sans-serif;
      font-weight:normal;
      }

      .number {
      padding-top:1px;
      padding-left:1px;
      font-size:12px;
      color:black;
      font-family:"Times New Roman";
      font-weight:normal;
      }

      #notes-form {
        display:none;
        padding-top: 20px;
      }

      .favorite {
        font-weight: bold;
      }

      .heading {
          border-bottom: 3px red solid;
          margin-bottom: 20px;
      }

      .title {
        border-bottom: 2px red solid;
        margin-bottom: 20px;
      }

      #clue-notes {
background: #fff9af; /* Old browsers */
/* IE9 SVG, needs conditional override of 'filter' to 'none' */
background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIxJSIgc3RvcC1jb2xvcj0iI2ZmZjlhZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNmZmYxNzUiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);
background: -moz-linear-gradient(top,  #fff9af 1%, #fff175 100%); /* FF3.6+ */
background: -webkit-gradient(linear, left top, left bottom, color-stop(1%,#fff9af), color-stop(100%,#fff175)); /* Chrome,Safari4+ */
background: -webkit-linear-gradient(top,  #fff9af 1%,#fff175 100%); /* Chrome10+,Safari5.1+ */
background: -o-linear-gradient(top,  #fff9af 1%,#fff175 100%); /* Opera 11.10+ */
background: -ms-linear-gradient(top,  #fff9af 1%,#fff175 100%); /* IE10+ */
background: linear-gradient(to bottom,  #fff9af 1%,#fff175 100%); /* W3C */
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#fff9af', endColorstr='#fff175',GradientType=0 ); /* IE6-8 */
border: none;
color: #111;
      font-family: 'Ubuntu', sans-serif;
      font-size: 15px;
      width: 100%;
}
    </style>
    <!--[if lt IE 7]>
	<script defer type="text/javascript" src="/site_media/js/pngfix.js"></script>
	<link rel="stylesheet" type="text/css" href="/site_media/css/ie.css" media="screen" />
	<![endif]-->
  </head>
  <body>
<div class="container_12">
  <div class="grid_12 heading"><h1>{{ name }}, {{ appeared|date:"jS F Y" }}</h1></div>
   <div class="grid_5">
    <form action="/save/" method="POST">
      <input type="hidden" id="grid_id" name="grid_id" value="{{ grid_id }}"/>
      <table class="grid">
	<tr>
	  {% for i in crossword %}
	  {% if forloop.counter0|divisibleby:"15" %}
	</tr>
	<tr>
	  {% endif %}
	  {% ifequal i.grid "0" %}
	  <td>
	    <div id="box_{{ forloop.counter }}" class="black-box {% cycle 'black-box1' 'black-box2' 'black-box3'%}"/>
	    <input type="hidden" id="{{ forloop.counter }}" name="{{ forloop.counter }}" size="1" maxlength="1" disabled="disabled" class="black-box"/>
	  </td>
	  {% else %}
	  {% if i.code %}
	  <td>
	    <div id="box_{{ forloop.counter }}" class="tile">
	      <div align="left" class="number">{{ i.code }}</div>
	      <div class="letter">{{ i.ans }}</div>
	      <input type="hidden" id="{{ forloop.counter }}" name="{{ forloop.counter }}" size="1" maxlength="1"  class="tile" value="{{ i.ans }}"/>
	    </div>
	  </td>
	  {% else %}
	  <td>
	    <div id="box_{{ forloop.counter }}" class="tile">
	      <div align="left" style="width:30px; height:15px;"></div>
	      <div class="letter">{{ i.ans }}</div>
	      <input type="hidden" id="{{ forloop.counter }}" name="{{ forloop.counter }}" size="1" maxlength="1" class="tile" value="{{ i.ans }}"/>
	    </div>
	  </td>
	  {% endif %}
	  {% endifequal %}
	  {% endfor %}
	</tr>
      </table>
      <input type="submit" value="save" id="save_crossword"/>
    </form>
      <div id="notes-form">
        <input type="hidden" id="clue-id" name="clue-id" value=""/>
        <div><textarea rows="4" id="clue-notes"></textarea></div>
        <input type="submit" value="write note" id="write-note"/>
	<input type="button" value="mark as favorite" id="add-favorite"/>
      </div>
    </div>
    <div class="grid_3 across_clues">
      <h3 class="title">Across</h3>
      {% for across_clue in across %}
      <div id="{{ across_clue.square }}c" class="clue {% if across_clue.favorite %} favorite {% endif %}"> {{ across_clue.code }} {{ across_clue.clue }}</div>
      <div class="notes"> {{ across_clue.note }} </div>
      {% endfor %}
    </div>
    <div class="grid_3 down_clues">
      <h3 class="title">Down</h3>
      {% for down_clue in down %}
      <div id="{{ down_clue.square }}c" class="clue{% if down_clue.favorite %} favorite {% endif %}"> {{ down_clue.code }} {{ down_clue.clue }}</div>
      <div class="notes"> {{ down_clue.note }} </div>
      {% endfor %}
    </div>
</div>
  </body>
</html>

